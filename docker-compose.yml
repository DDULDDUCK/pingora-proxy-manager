services:
  pingora-proxy:
    build: .
    image: pingora-proxy-manager:latest
    container_name: pingora-proxy
    restart: always
    ports:
      - "80:8080"   # HTTP Proxy (Backend listens on 8080)
      - "81:81"     # Dashboard/API (Backend listens on 81)
      # HTTPS Port 443 is mapped to 443 on host, backend should listen on 443 inside if privileged, 
      # or we map 443->8443 if backend uses unprivileged port. 
      # For now, assuming backend binds to 443 or uses NAT. 
      # Let's map 443 -> 443 but backend needs to bind it.
      # If backend binds 8080 for HTTP, usually it binds 8443 for HTTPS.
      # Let's stick to 80->8080 and 81->81 for now as per main.rs logic.
    volumes:
      - ./data:/app/data        # DB and Certs persistence
      - ./logs:/app/logs        # Logs persistence
    environment:
      - JWT_SECRET=changeme_in_production_please
      - RUST_LOG=info
      - PPM_TRUSTED_PROXY_IPS=${PPM_TRUSTED_PROXY_IPS:-127.0.0.1}
